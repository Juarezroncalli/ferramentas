<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerador de Layout de Patrimônio</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #4f0072;
        --accent-color: #fb0a5e;
        --background-color: #ffffff;
        --form-bg-color: #f9f9f9;
        --text-color: #333333;
        --border-color: #e0e0e0;
        --text-color-light: #ffffff;
        --sombra: 0 4px 12px rgba(79, 0, 114, 0.15);
        --transicao: all 0.3s ease;
        --primary-dark: #3d005a;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
        --text-muted: #64748b;
        --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),
          0 4px 6px -4px rgb(0 0 0 / 0.1);
        --radius: 0.5rem;
        --radius-lg: 0.75rem;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: linear-gradient(135deg, #4f0072 0%, #fb0a5e 100%);
        min-height: 100vh;
        color: var(--text-color);
        line-height: 1.6;
        padding: 2rem 1rem;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 3rem;
      }

      .header h1 {
        color: white;
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header p {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.1rem;
      }

      .content-card {
        background: var(--background-color);
        border-radius: var(--radius-lg);
        padding: 2.5rem;
        box-shadow: var(--sombra);
        margin-bottom: 2rem;
      }

      h2 {
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
        color: var(--primary-color);
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 0.75rem;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
      }

      .form-group {
        margin-bottom: 1rem;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--primary-color);
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 0.8rem;
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        font-size: 1rem;
        transition: var(--transicao);
        background-color: #fff;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(79, 0, 114, 0.1);
      }

      .btn {
        background: var(--primary-color);
        color: var(--text-color-light);
        border: none;
        padding: 0.875rem 2rem;
        border-radius: var(--radius);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transicao);
        box-shadow: var(--sombra);
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        justify-content: center;
      }

      .btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .btn:disabled {
        background: var(--text-muted);
        cursor: not-allowed;
        transform: none;
      }

      .btn-accent {
        background-color: var(--accent-color);
      }

      .btn-accent:hover {
        background-color: #d9094f;
      }

      .btn-outline {
        background-color: transparent;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
      }
      .btn-outline:hover {
        background-color: var(--primary-color);
        color: var(--text-color-light);
      }

      .actions {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
        flex-wrap: wrap;
      }

      .items-list {
        margin-top: 2.5rem;
      }

      .item-card {
        background-color: var(--form-bg-color);
        border-left: 4px solid var(--primary-color);
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: var(--transicao);
      }
      .item-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--sombra);
      }

      .item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .item-title {
        font-weight: 700;
        font-size: 1.2rem;
        color: var(--primary-color);
      }

      .item-details {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 0.5rem 1.5rem;
        font-size: 0.9rem;
      }

      .detail-label {
        font-weight: 600;
        margin-right: 0.5rem;
        color: var(--text-muted);
      }

      .remove-btn {
        background-color: var(--error);
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transicao);
      }

      .remove-btn:hover {
        background-color: #c0392b;
        transform: scale(1.1);
      }

      .results {
        background: var(--background-color);
        border-radius: var(--radius-lg);
        box-shadow: var(--sombra);
        overflow: hidden;
        display: none;
        margin-top: 2rem;
      }

      .results.show {
        display: block;
        animation: slideIn 0.5s ease-out;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .results-header {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: var(--text-color-light);
        padding: 1.5rem 2rem;
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      .results-title {
        font-size: 1.25rem;
        font-weight: 600;
      }
      .results-content {
        padding: 2rem;
      }

      .result-box {
        background-color: var(--form-bg-color);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        white-space: pre-wrap;
        word-break: break-all;
        max-height: 300px;
        overflow-y: auto;
        font-family: "Fira Code", "Consolas", monospace;
      }

      .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: var(--text-muted);
        background: var(--form-bg-color);
        border-radius: var(--radius);
        border: 2px dashed var(--border-color);
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      @media (max-width: 768px) {
        body {
          padding: 1rem;
        }
        .header h1 {
          font-size: 2rem;
        }
        .content-card,
        .results-content {
          padding: 1.5rem;
        }
        .form-grid {
          grid-template-columns: 1fr;
        }
        .actions {
          flex-direction: column;
        }
        .btn {
          width: 100%;
        }
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-archive"></i> Gerador de Layout de Patrimônio</h1>
        <p>
          Crie um arquivo de texto para o cadastro de bens (Leiaute Domínio
          Sistemas PMBEM)
        </p>
      </div>

      <div class="content-card">
        <h2><i class="fas fa-plus-circle"></i> Adicionar Item</h2>
        <form id="patrimonioForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="numeroEmpresa">Número da Empresa*</label>
              <input type="number" id="numeroEmpresa" required />
            </div>
            <div class="form-group">
              <label for="codigo">Código*</label>
              <input type="number" id="codigo" required />
            </div>
            <div class="form-group">
              <label for="identificador">Identificador*</label>
              <input type="number" id="identificador" required />
            </div>
            <div class="form-group">
              <label for="nome">Nome*</label>
              <input type="text" id="nome" required />
            </div>
            <div class="form-group">
              <label for="dataAquisicao">Data Aquisição*</label>
              <input type="date" id="dataAquisicao" required />
            </div>
            <div class="form-group">
              <label for="contaPatrimonial">Conta Patrimonial*</label>
              <input type="text" id="contaPatrimonial" required />
            </div>
            <div class="form-group">
              <label for="centroCusto">Centro de Custo*</label>
              <input type="text" id="centroCusto" required />
            </div>
            <div class="form-group" style="grid-column: 1 / -1">
              <label for="historico">Histórico*</label>
              <textarea
                id="historico"
                rows="3"
                required
                style="resize: vertical"
              ></textarea>
            </div>
            <div class="form-group">
              <label for="funcao">Função (USO)*</label>
              <input
                type="text"
                id="funcao"
                required
                value="ATIVO"
                placeholder="ATIVO"
              />
            </div>
            <div class="form-group">
              <label for="valorAquisicao">Valor Aquisição*</label>
              <input type="number" id="valorAquisicao" step="0.01" required />
            </div>
          </div>
          <div class="actions">
            <button type="submit" class="btn">
              <i class="fas fa-plus"></i>Adicionar Item
            </button>
            <button type="reset" class="btn btn-outline">
              <i class="fas fa-eraser"></i>Limpar Campos
            </button>
          </div>
        </form>

        <div class="items-list" id="itemsList">
          <h2><i class="fas fa-list-ul"></i> Itens Adicionados</h2>
          <div id="emptyState" class="empty-state">
            <i class="fas fa-clipboard-list"></i>
            <p>Nenhum item adicionado ainda.</p>
          </div>
          <div id="itemsContainer"></div>
        </div>

        <div class="actions">
          <button
            id="gerarTxtBtn"
            class="btn btn-accent"
            style="width: 100%"
            disabled
          >
            <i class="fas fa-cogs"></i>Gerar Arquivo TXT
          </button>
        </div>
      </div>

      <div class="results" id="resultArea">
        <div class="results-header">
          <i class="fas fa-file-alt"></i>
          <div class="results-title">Layout Gerado</div>
        </div>
        <div class="results-content">
          <div class="result-box" id="resultBox"></div>
          <div class="actions">
            <button id="downloadBtn" class="btn">
              <i class="fas fa-download"></i>Baixar Arquivo TXT
            </button>
            <button id="copyBtn" class="btn btn-outline">
              <i class="fas fa-copy"></i>Copiar Conteúdo
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let items = [];

      const form = document.getElementById("patrimonioForm");
      const itemsContainer = document.getElementById("itemsContainer");
      const emptyState = document.getElementById("emptyState");
      const gerarTxtBtn = document.getElementById("gerarTxtBtn");
      const resultArea = document.getElementById("resultArea");
      const resultBox = document.getElementById("resultBox");
      const downloadBtn = document.getElementById("downloadBtn");
      const copyBtn = document.getElementById("copyBtn");

      const numeroEmpresaInput = document.getElementById("numeroEmpresa");
      const codigoInput = document.getElementById("codigo");
      const identificadorInput = document.getElementById("identificador");
      const nomeInput = document.getElementById("nome");
      const funcaoInput = document.getElementById("funcao");

      function formatDate(dateString) {
        return dateString.replace(/-/g, "");
      }

      function formatValorMonetario(valor) {
        return parseFloat(valor).toFixed(2).replace(".", ",");
      }

      function prefillNextItemFields(lastItem) {
        if (lastItem) {
          numeroEmpresaInput.value = lastItem.numeroEmpresa;
          if (lastItem.codigo && !isNaN(parseInt(lastItem.codigo))) {
            codigoInput.value = parseInt(lastItem.codigo) + 1;
          }
          if (
            lastItem.identificador &&
            !isNaN(parseInt(lastItem.identificador))
          ) {
            identificadorInput.value = parseInt(lastItem.identificador) + 1;
          }
          funcaoInput.value = lastItem.funcao || "ATIVO";
        }
        nomeInput.focus();
      }

      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const item = {
          numeroEmpresa: numeroEmpresaInput.value,
          codigo: codigoInput.value,
          identificador: identificadorInput.value,
          nome: nomeInput.value,
          dataAquisicao: formatDate(
            document.getElementById("dataAquisicao").value
          ),
          contaPatrimonial: document.getElementById("contaPatrimonial").value,
          centroCusto: document.getElementById("centroCusto").value,
          historico: document.getElementById("historico").value,
          funcao: funcaoInput.value || "ATIVO",
          valorAquisicao: document.getElementById("valorAquisicao").value,
        };
        items.push(item);
        renderItems();
        form.reset();
        prefillNextItemFields(item);
      });

      function renderItems() {
        if (items.length === 0) {
          emptyState.classList.remove("hidden");
          gerarTxtBtn.disabled = true;
          resultArea.classList.remove("show");
        } else {
          emptyState.classList.add("hidden");
          gerarTxtBtn.disabled = false;
          itemsContainer.innerHTML = "";
          items.forEach((item, index) => {
            const itemCard = document.createElement("div");
            itemCard.className = "item-card";
            itemCard.innerHTML = `
              <div class="item-header">
                  <div class="item-title">${item.nome} (Cód: ${
              item.codigo
            })</div>
                  <button class="remove-btn" data-index="${index}" title="Remover item">✕</button>
              </div>
              <div class="item-details">
                  <div><span class="detail-label">Empresa:</span><span>${
                    item.numeroEmpresa
                  }</span></div>
                  <div><span class="detail-label">ID:</span><span>${
                    item.identificador
                  }</span></div>
                  <div><span class="detail-label">Data:</span><span>${formatDateDisplay(
                    item.dataAquisicao
                  )}</span></div>
                  <div><span class="detail-label">Valor:</span><span>R$ ${parseFloat(
                    item.valorAquisicao
                  ).toLocaleString("pt-BR", {
                    minimumFractionDigits: 2,
                  })}</span></div>
              </div>`;
            itemsContainer.appendChild(itemCard);
          });
          document.querySelectorAll(".remove-btn").forEach((button) => {
            button.addEventListener("click", function () {
              removeItem(parseInt(this.getAttribute("data-index")));
            });
          });
        }
      }

      function formatDateDisplay(dateString) {
        if (!dateString || dateString.length !== 8) return dateString;
        const year = dateString.substring(0, 4);
        const month = dateString.substring(4, 6);
        const day = dateString.substring(6, 8);
        return `${day}/${month}/${year}`;
      }

      function removeItem(index) {
        items.splice(index, 1);
        renderItems();
        if (items.length > 0) {
          prefillNextItemFields(items[items.length - 1]);
        } else {
          form.reset();
          prefillNextItemFields({}); // Clear with defaults
        }
      }

      gerarTxtBtn.addEventListener("click", function () {
        if (items.length === 0) {
          resultBox.textContent = "Nenhum item para gerar.";
          resultArea.classList.add("show");
          return;
        }
        let result = "";
        items.forEach((item) => {
          let valorAquisicaoFormatado = formatValorMonetario(
            item.valorAquisicao
          );
          let line = `${item.numeroEmpresa};${item.codigo};${item.identificador};${item.nome};${item.dataAquisicao};;${item.contaPatrimonial};${item.centroCusto};${item.historico};B;I;;;${item.funcao};${valorAquisicaoFormatado};;;;;;;;;;;${valorAquisicaoFormatado};;;;;;S;N;${item.dataAquisicao};N;;;;;N;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;`;
          result += line + "\n";
        });
        resultBox.textContent = result;
        resultArea.classList.add("show");
      });

      downloadBtn.addEventListener("click", function () {
        const content = resultBox.textContent;
        if (!content || content === "Nenhum item para gerar.") return;
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "patrimonio_layout.txt";
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, 100);
      });

      copyBtn.addEventListener("click", function () {
        const content = resultBox.textContent;
        if (!content || content === "Nenhum item para gerar.") return;
        navigator.clipboard.writeText(content).then(
          () => {
            const originalText = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="fas fa-check"></i> Copiado!';
            copyBtn.disabled = true;
            setTimeout(() => {
              copyBtn.innerHTML = originalText;
              copyBtn.disabled = false;
            }, 2000);
          },
          (err) => {
            console.error("Erro ao copiar: ", err);
            alert("Falha ao copiar. Tente manualmente.");
          }
        );
      });

      form.addEventListener("reset", function () {
        setTimeout(() => {
          if (items.length > 0) {
            prefillNextItemFields(items[items.length - 1]);
          } else {
            prefillNextItemFields({}); // Clear with defaults
            numeroEmpresaInput.value = "";
            codigoInput.value = "";
            identificadorInput.value = "";
            numeroEmpresaInput.focus();
          }
        }, 0);
      });

      // Keydown listeners for better form flow
      ["keydown", "blur"].forEach((evt) => {
        codigoInput.addEventListener(evt, (e) => {
          if (e.type === "blur" || e.key === "Enter") {
            e.preventDefault();
            identificadorInput.focus();
          }
        });
        identificadorInput.addEventListener(evt, (e) => {
          if (e.type === "blur" || e.key === "Enter") {
            e.preventDefault();
            nomeInput.focus();
          }
        });
      });

      renderItems();
    </script>
  </body>
</html>
