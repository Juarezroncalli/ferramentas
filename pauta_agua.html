<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ICMS ST √Ågua [BRUTALISM]</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
      :root {
        /* --- PALETA VIBRANTE --- */
        --bg-body: #06B6D4; /* Ciano (Fundo Azul) */
        --card-bg: #FFFFFF;
        --border-black: #000000;
        
        --color-primary: #8B5CF6;   /* Roxo */
        --color-secondary: #F472B6; /* Rosa */
        --color-accent: #FACC15;    /* Amarelo */
        --color-success: #22C55E;   /* Verde */
        --color-danger: #EF4444;    /* Vermelho */
        --color-info: #3B82F6;      /* Azul Royal */
        
        --shadow-dist: 6px;
        --border-width: 3px;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
        font-family: 'Space Grotesk', sans-serif;
        /* FUNDO AZUL QUADRICULADO */
        background-color: var(--bg-body);
        background-image: 
            linear-gradient(#fff 2px, transparent 2px),
            linear-gradient(90deg, #fff 2px, transparent 2px);
        background-size: 40px 40px;
        background-position: -2px -2px;
        
        color: var(--border-black);
        height: 100vh;
        overflow: hidden;
        display: flex;
      }

      /* Sidebar */
      .sidebar {
        width: 280px;
        background: var(--color-accent); /* Amarelo */
        border-right: var(--border-width) solid var(--border-black);
        display: flex;
        flex-direction: column;
        padding: 2rem 1.5rem;
        flex-shrink: 0;
        overflow-y: auto;
        box-shadow: 4px 0 0 rgba(0,0,0,0.1);
      }

      .logo {
        font-weight: 900;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 3rem;
        text-transform: uppercase;
        letter-spacing: -1px;
      }

      .logo i {
        background: var(--color-info); /* Azul */
        color: #fff;
        padding: 10px;
        border: var(--border-width) solid var(--border-black);
        box-shadow: 4px 4px 0 0 black;
        font-size: 1.2rem;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px;
        margin-bottom: 1rem;
        font-weight: 800;
        color: #000;
        cursor: pointer;
        transition: 0.1s;
        border: var(--border-width) solid var(--border-black);
        background: #fff;
        box-shadow: 4px 4px 0 0 black;
        text-transform: uppercase;
        font-size: 0.9rem;
      }

      .nav-item.active {
        background-color: var(--color-primary);
        color: #fff;
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 0 black;
      }

      .nav-item:hover:not(.active) {
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 0 black;
      }

      .main-content { flex: 1; padding: 2rem; overflow-y: auto; display: flex; flex-direction: column; }

      /* Neo Header */
      .neo-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2.5rem;
        background: #fff;
        border: var(--border-width) solid var(--border-black);
        padding: 2rem;
        box-shadow: var(--shadow-dist) var(--shadow-dist) 0 #000;
        flex-shrink: 0;
      }
      .header-title h1 { 
        font-weight: 900; 
        font-size: 2.5rem; 
        text-transform: uppercase;
        text-shadow: 2px 2px 0 #ddd;
      }
      .header-title span { 
        font-family: 'Space Mono', monospace;
        font-size: 0.9rem; 
        font-weight: 700; 
        background: var(--color-success);
        color: #000;
        padding: 5px 10px;
        border: 2px solid #000;
      }

      /* Layout Principal (Duas Colunas) */
      .calc-container {
        display: flex;
        gap: 2rem;
        flex: 1;
        align-items: flex-start;
        overflow: hidden; /* Para permitir scroll interno se necess√°rio */
      }

      /* Coluna Esquerda: Inputs */
      .input-section {
        flex: 1;
        background: #fff;
        border: var(--border-width) solid var(--border-black);
        padding: 2rem;
        box-shadow: var(--shadow-dist) var(--shadow-dist) 0 #000;
        min-width: 320px;
        height: 100%;
        overflow-y: auto;
      }

      .input-section h2 {
        font-weight: 900;
        text-transform: uppercase;
        border-bottom: 3px solid #000;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }

      label {
        font-weight: 800;
        display: block;
        margin-bottom: 0.5rem;
        font-size: 1rem;
        text-transform: uppercase;
      }

      .form-group { margin-bottom: 1.5rem; }

      .neo-input {
        width: 100%;
        padding: 15px;
        font-size: 1.1rem;
        font-family: 'Space Mono', monospace;
        font-weight: bold;
        border: var(--border-width) solid var(--border-black);
        background: #F3F4F6;
        outline: none;
        transition: all 0.2s;
      }
      .neo-input:focus {
        background-color: #fff;
        box-shadow: 5px 5px 0 0 var(--color-primary);
        transform: translate(-2px, -2px);
      }

      .neo-btn {
        padding: 15px;
        font-weight: 800;
        font-size: 1.1rem;
        font-family: 'Space Grotesk', sans-serif;
        border: var(--border-width) solid var(--border-black);
        cursor: pointer;
        box-shadow: 5px 5px 0 0 black;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: all 0.1s;
        width: 100%;
        text-transform: uppercase;
      }
      .neo-btn:active {
        box-shadow: 0 0 0 0 black;
        transform: translate(4px, 4px);
      }

      .btn-add { background-color: var(--color-success); color: black; }
      .btn-add:hover { transform: translate(-2px, -2px); box-shadow: 7px 7px 0 0 black; }
      
      .btn-print { background-color: var(--color-secondary); color: white; margin-bottom: 1rem; }
      .btn-print:hover { transform: translate(-2px, -2px); box-shadow: 7px 7px 0 0 black; }

      /* Coluna Direita: Recibo */
      .receipt-section {
        flex: 1;
        background: var(--color-accent); /* Fundo Amarelo */
        border: var(--border-width) solid var(--border-black);
        padding: 1.5rem;
        box-shadow: var(--shadow-dist) var(--shadow-dist) 0 #000;
        min-width: 320px;
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .receipt-paper {
        background: #fff;
        font-family: 'Space Mono', monospace;
        padding: 1.5rem;
        border: 3px dashed #000;
        flex: 1;
        overflow-y: auto;
        font-size: 0.9rem;
        color: #000;
        position: relative;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
      }

      .receipt-header {
        text-align: center;
        border-bottom: 3px dashed black;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
      }
      .receipt-header h2 { font-size: 1.1rem; margin-bottom: 5px; font-weight: 900; text-transform: uppercase; }
      .receipt-header p { margin: 2px 0; font-size: 0.8rem; }

      .receipt-item {
        border-bottom: 1px dashed #000;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
      }

      .receipt-total {
        font-size: 1.4rem;
        font-weight: 900;
        text-align: right;
        margin-top: 1rem;
        border-top: 3px solid black;
        padding-top: 1rem;
        background: #000;
        color: #fff;
        padding: 10px;
      }

      .calculation-line {
        margin: 4px 0;
        font-size: 0.85rem;
      }
      
      .error {
        color: #fff;
        background-color: var(--color-danger);
        padding: 15px;
        border: 2px solid black;
        font-weight: bold;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        display: none;
        box-shadow: 4px 4px 0 0 black;
      }
      .error:not(:empty) { display: block; }

      /* Estilos de Impress√£o */
      @media print {
        body { background: white; height: auto; display: block; overflow: visible; }
        .sidebar, .neo-header, .input-section, .btn-print, h1 { display: none !important; }
        .calc-container { display: block; margin: 0; padding: 0; }
        .receipt-section { 
            box-shadow: none; border: none; background: white; 
            width: 100%; max-width: 100%; padding: 0; margin: 0; 
            max-height: none; overflow: visible;
        }
        .receipt-paper { border: 2px solid #000; padding: 20px; font-size: 10pt; }
        .receipt-total { font-size: 14pt; background: #fff; color: #000; border-top: 2px solid #000; }
      }

      @media (max-width: 900px) {
        body { flex-direction: column; overflow: auto; }
        .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 3px solid black; flex-direction: row; align-items: center; overflow-x: auto; padding: 1rem; }
        .calc-container { flex-direction: column; height: auto; }
        .input-section, .receipt-section { width: 100%; height: auto; min-height: 500px; }
      }
    </style>
  </head>
  <body>

    <aside class="sidebar">
      <div class="logo">
        <i class="fas fa-hand-holding-droplet"></i>
        <span>WaterCalc</span>
      </div>
      <nav>
        <div class="nav-item active">
          <i class="fas fa-calculator"></i> ICMS ST √Ågua
        </div>
        <div class="nav-item">
          <i class="fas fa-history"></i> Hist√≥rico
        </div>
      </nav>
    </aside>

    <main class="main-content">
      
      <div class="neo-header">
        <div class="header-title">
          <h1>C√°lculo ICMS ST üíß</h1>
          <span>√Ågua Mineral (Gal√£o 20L) - Pauta Fiscal</span>
        </div>
      </div>

      <div class="calc-container">
        <div class="input-section">
            <h2>üìù Dados da Nota</h2>
            
            <div class="form-group">
                <label for="invoiceNumber">N√∫mero da NF</label>
                <input type="text" id="invoiceNumber" class="neo-input" placeholder="Ex: 123456" />
            </div>

            <div class="form-group">
                <label for="waterQuantity">Quantidade (Unid.)</label>
                <input type="number" id="waterQuantity" class="neo-input" placeholder="0" min="0" step="1" />
            </div>

            <div class="form-group">
                <label for="invoiceValue">Valor Total da NF (R$)</label>
                <input type="number" id="invoiceValue" class="neo-input" placeholder="0,00" min="0" step="0.01" />
            </div>

            <div id="errorMessage" class="error"></div>

            <button id="addButton" class="neo-btn btn-add">
                <i class="fas fa-plus-circle"></i> ADICIONAR C√ÅLCULO
            </button>
        </div>

        <div class="receipt-section">
            <button id="printButton" class="neo-btn btn-print">
                <i class="fas fa-print"></i> IMPRIMIR RECIBO
            </button>
            
            <div class="receipt-paper">
                <div class="receipt-header">
                    <h2>SUPERMERCADO MARQUES & AVILA</h2>
                    <p>CNPJ: 00.000.000/0001-00</p>
                    <p><strong>MEM√ìRIA DE C√ÅLCULO - ICMS ST</strong></p>
                    <p>
                      Data: <span id="currentDate"></span> | Hora: <span id="currentTime"></span>
                    </p>
                    <p style="font-style: italic; font-size: 0.75rem; margin-top: 5px; background: #eee; padding: 5px; border: 1px solid #000;">
                      Pauta Vigente: R$ 13,35 (Gal√£o 20L)
                    </p>
                </div>

                <div id="receiptItems">
                    <div style="text-align: center; color: #999; padding: 20px; font-style: italic;">
                        -- Nenhum item calculado ainda --
                    </div>
                </div>

                <div class="receipt-total">
                    TOTAL A PAGAR: R$ <span id="totalAmount">0,00</span>
                </div>
            </div>
        </div>
      </div>

    </main>

    <script>
      // Atualiza Data/Hora
      function updateDateTime() {
        const now = new Date();
        const dateEl = document.getElementById("currentDate");
        const timeEl = document.getElementById("currentTime");
        if(dateEl) dateEl.textContent = now.toLocaleDateString("pt-BR");
        if(timeEl) timeEl.textContent = now.toLocaleTimeString("pt-BR");
      }
      updateDateTime();

      // Fun√ß√µes de Moeda (Centavos)
      function toCents(value) { return Math.round(value * 100); }
      function fromCents(cents) { return cents / 100; }
      function formatCurrency(cents) {
        const reais = fromCents(cents);
        return reais.toLocaleString("pt-BR", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }

      // Estado
      let items = [];
      let totalCents = 0;
      let itemCount = 0;

      // Event Listeners
      document.getElementById("printButton").addEventListener("click", () => window.print());

      document.getElementById("addButton").addEventListener("click", function () {
          const invoiceNumber = document.getElementById("invoiceNumber").value;
          const waterQuantity = parseFloat(document.getElementById("waterQuantity").value);
          const invoiceValue = parseFloat(document.getElementById("invoiceValue").value);
          const errorElement = document.getElementById("errorMessage");
          const receiptItemsContainer = document.getElementById("receiptItems");

          // Valida√ß√£o
          if (!invoiceNumber || isNaN(waterQuantity) || isNaN(invoiceValue)) {
            errorElement.textContent = "‚ö†Ô∏è Preencha todos os campos corretamente.";
            return;
          }
          if (waterQuantity <= 0 || invoiceValue <= 0) {
            errorElement.textContent = "‚ö†Ô∏è Quantidade e valor devem ser maiores que zero.";
            return;
          }
          errorElement.textContent = "";

          // Remove mensagem de "vazio" se for o primeiro item
          if (itemCount === 0) receiptItemsContainer.innerHTML = "";

          // C√°lculos (L√≥gica Original)
          const invoiceValueCents = toCents(invoiceValue);
          const baseIcmsStCents = toCents(waterQuantity * 13.35);
          const reducedBaseIcmsStCents = Math.round(baseIcmsStCents * (1 - 0.6111));
          const icmsStCents = Math.round(reducedBaseIcmsStCents * 0.18);
          const reducedInvoiceValueCents = Math.round(invoiceValueCents * (1 - 0.6111));
          const icmsCreditCents = Math.round(reducedInvoiceValueCents * 0.18);
          const amountToPayCents = icmsStCents - icmsCreditCents;

          // Atualiza Estado
          itemCount++;
          totalCents += amountToPayCents;

          // Cria Elemento HTML
          const itemDiv = document.createElement("div");
          itemDiv.className = "receipt-item";
          itemDiv.innerHTML = `
            <div class="calculation-line" style="font-weight:900; margin-bottom: 5px; font-size: 1rem;">#${itemCount} - NF: ${invoiceNumber}</div>
            <div class="calculation-line">Qtd: ${waterQuantity} | Valor NF: R$ ${formatCurrency(invoiceValueCents)}</div>
            <div class="calculation-line" style="margin-top: 5px;">
                Base ST (Pauta): R$ ${formatCurrency(baseIcmsStCents)} <br>
                Base Reduzida: R$ ${formatCurrency(reducedBaseIcmsStCents)} <br>
                ICMS ST (18%): R$ ${formatCurrency(icmsStCents)}
            </div>
            <div class="calculation-line" style="color: #555;">
                (-) Cr√©dito: R$ ${formatCurrency(icmsCreditCents)}
            </div>
            <div class="calculation-line" style="font-weight: 900; margin-top: 5px; font-size: 1.1rem; background: #eee; padding: 2px;">
                = R$ ${formatCurrency(amountToPayCents)}
            </div>
          `;

          receiptItemsContainer.appendChild(itemDiv);

          // Atualiza Total
          document.getElementById("totalAmount").textContent = formatCurrency(totalCents);

          // Limpa Inputs
          document.getElementById("invoiceNumber").value = "";
          document.getElementById("waterQuantity").value = "";
          document.getElementById("invoiceValue").value = "";

          // Scroll para baixo na √°rea do recibo
          const paper = document.querySelector(".receipt-paper");
          paper.scrollTop = paper.scrollHeight;
      });
    </script>
  </body>
</html>