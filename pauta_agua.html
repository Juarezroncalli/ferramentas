<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ICMS ST √Ågua - Neo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
      :root {
        /* Paleta Neo-Brutalismo */
        --bg-color: #FFFDF5;
        --card-bg: #FFFFFF;
        
        --primary-green: #2DDD98;
        --primary-yellow: #FFF59D;
        --primary-purple: #D6BCFA;
        --primary-pink: #FF9EB5;
        --primary-blue: #A5DEFF;
        
        --text-main: #000000;
        --border-black: #000000;
        
        --shadow-hard: 4px 4px 0px 0px #000000;
        --border-width: 3px;
        --radius: 12px;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-main);
        height: 100vh;
        overflow-x: hidden;
        display: flex;
      }

      /* Sidebar */
      .sidebar {
        width: 250px;
        background: var(--card-bg);
        border-right: var(--border-width) solid var(--border-black);
        display: flex;
        flex-direction: column;
        padding: 2rem 1.5rem;
        flex-shrink: 0;
      }

      .logo {
        font-weight: 800;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 3rem;
      }

      .logo i {
        background: var(--primary-blue);
        padding: 8px;
        border: var(--border-width) solid var(--border-black);
        border-radius: 50%;
        box-shadow: 2px 2px 0 0 black;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        font-weight: 600;
        color: #555;
        cursor: pointer;
        transition: 0.2s;
        border-radius: var(--radius);
        border: 2px solid transparent;
      }

      .nav-item.active {
        background-color: var(--primary-green);
        color: black;
        border: var(--border-width) solid var(--border-black);
        box-shadow: var(--shadow-hard);
      }
      .nav-item:hover:not(.active) { background-color: #f0f0f0; }

      .main-content { flex: 1; padding: 2rem; overflow-y: auto; display: flex; flex-direction: column; }

      /* Neo Header */
      .neo-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        background: var(--card-bg);
        border: var(--border-width) solid var(--border-black);
        border-radius: 50px;
        padding: 1rem 2rem;
        box-shadow: var(--shadow-hard);
      }
      .header-title h1 { font-weight: 800; font-size: 2rem; }
      .header-title span { font-size: 1rem; font-weight: 600; color: #666; }

      /* Container Principal (Duas Colunas) */
      .calc-container {
        display: flex;
        gap: 2rem;
        flex: 1;
        align-items: flex-start;
      }

      /* Coluna Esquerda: Inputs */
      .input-section {
        flex: 1;
        background: var(--card-bg);
        border: var(--border-width) solid var(--border-black);
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow-hard);
        min-width: 300px;
      }

      label {
        font-weight: 800;
        display: block;
        margin-bottom: 0.5rem;
        font-size: 1rem;
      }

      .form-group { margin-bottom: 1.5rem; }

      .neo-input {
        width: 100%;
        padding: 1rem;
        font-size: 1.1rem;
        font-weight: 600;
        border: var(--border-width) solid var(--border-black);
        border-radius: var(--radius);
        outline: none;
        background: #f9f9f9;
      }
      .neo-input:focus {
        background-color: #fff;
        box-shadow: 4px 4px 0 0 rgba(0,0,0,0.1);
      }

      .neo-btn {
        padding: 1rem 2rem;
        font-weight: 800;
        font-size: 1.1rem;
        border: var(--border-width) solid var(--border-black);
        border-radius: var(--radius);
        cursor: pointer;
        box-shadow: var(--shadow-hard);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: transform 0.1s;
        width: 100%;
        text-transform: uppercase;
      }
      .neo-btn:active {
        box-shadow: 0 0 0 0 black;
        transform: translate(4px, 4px);
      }

      .btn-add { background-color: var(--primary-green); color: black; }
      .btn-print { background-color: var(--primary-pink); color: black; margin-bottom: 1rem; }

      /* Coluna Direita: Recibo */
      .receipt-section {
        flex: 1;
        background: var(--primary-yellow); /* Fundo amarelo estilo nota */
        border: var(--border-width) solid var(--border-black);
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow-hard);
        min-width: 300px;
        display: flex;
        flex-direction: column;
        max-height: 80vh;
      }

      .receipt-paper {
        background: #fff;
        font-family: 'Space Mono', monospace; /* Fonte monoespa√ßada para estilo cupom */
        padding: 1.5rem;
        border: 2px dashed #ccc;
        flex: 1;
        overflow-y: auto;
        font-size: 0.9rem;
        color: #333;
        position: relative;
      }

      .receipt-header {
        text-align: center;
        border-bottom: 2px dashed black;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
      }
      .receipt-header h2 { font-size: 1.2rem; margin-bottom: 5px; font-weight: bold; }
      .receipt-header p { margin: 2px 0; font-size: 0.8rem; }

      .receipt-item {
        border-bottom: 1px dashed #ccc;
        padding-bottom: 0.8rem;
        margin-bottom: 0.8rem;
      }

      .receipt-total {
        font-size: 1.4rem;
        font-weight: 900;
        text-align: right;
        margin-top: 1rem;
        border-top: 3px solid black;
        padding-top: 1rem;
      }

      .calculation-line {
        margin: 2px 0;
        font-size: 0.8rem;
      }
      
      .error {
        color: black;
        background-color: #FF5252;
        padding: 10px;
        border: 2px solid black;
        border-radius: 8px;
        font-weight: bold;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        display: none;
      }
      .error:not(:empty) { display: block; }

      /* Estilos de Impress√£o */
      @media print {
        body { background: white; height: auto; display: block; overflow: visible; }
        .sidebar, .neo-header, .input-section, .btn-print, h1 { display: none !important; }
        .calc-container { display: block; margin: 0; padding: 0; }
        .receipt-section { 
            box-shadow: none; border: none; background: white; 
            width: 100%; max-width: 100%; padding: 0; margin: 0; 
            max-height: none; overflow: visible;
        }
        .receipt-paper { border: none; padding: 0; font-size: 10pt; }
        .receipt-total { font-size: 14pt; }
      }

      @media (max-width: 900px) {
        body { flex-direction: column; overflow: auto; }
        .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 3px solid black; flex-direction: row; align-items: center; overflow-x: auto; padding: 1rem; }
        .calc-container { flex-direction: column; }
        .input-section, .receipt-section { width: 100%; }
      }
    </style>
  </head>
  <body>

    <aside class="sidebar">
      <div class="logo">
        <i class="fas fa-hand-holding-droplet"></i>
        <span>WaterCalc</span>
      </div>
      <nav>
        <div class="nav-item active">
          <i class="fas fa-calculator"></i> ICMS ST √Ågua
        </div>
        <div class="nav-item">
          <i class="fas fa-history"></i> Hist√≥rico
        </div>
      </nav>
    </aside>

    <main class="main-content">
      
      <div class="neo-header">
        <div class="header-title">
          <h1>C√°lculo ICMS ST üíß</h1>
          <span>√Ågua Mineral (Gal√£o 20L) - Pauta Fiscal</span>
        </div>
      </div>

      <div class="calc-container">
        <div class="input-section">
            <h2 style="margin-bottom: 1.5rem;">üìù Dados da Nota</h2>
            
            <div class="form-group">
                <label for="invoiceNumber">N√∫mero da NF</label>
                <input type="text" id="invoiceNumber" class="neo-input" placeholder="Ex: 123456" />
            </div>

            <div class="form-group">
                <label for="waterQuantity">Quantidade (Unid.)</label>
                <input type="number" id="waterQuantity" class="neo-input" placeholder="0" min="0" step="1" />
            </div>

            <div class="form-group">
                <label for="invoiceValue">Valor Total da NF (R$)</label>
                <input type="number" id="invoiceValue" class="neo-input" placeholder="0,00" min="0" step="0.01" />
            </div>

            <div id="errorMessage" class="error"></div>

            <button id="addButton" class="neo-btn btn-add">
                <i class="fas fa-plus-circle"></i> ADICIONAR C√ÅLCULO
            </button>
        </div>

        <div class="receipt-section">
            <button id="printButton" class="neo-btn btn-print">
                <i class="fas fa-print"></i> IMPRIMIR RECIBO
            </button>
            
            <div class="receipt-paper">
                <div class="receipt-header">
                    <h2>SUPERMERCADO MARQUES & AVILA</h2>
                    <p>CNPJ: 00.000.000/0001-00</p>
                    <p>MEM√ìRIA DE C√ÅLCULO - ICMS ST</p>
                    <p>
                      Data: <span id="currentDate"></span> | Hora: <span id="currentTime"></span>
                    </p>
                    <p style="font-style: italic; font-size: 0.75rem; margin-top: 5px; background: #eee; padding: 2px;">
                      Pauta Vigente: R$ 12,96 (Gal√£o 20L)
                    </p>
                </div>

                <div id="receiptItems">
                    <div style="text-align: center; color: #999; padding: 20px;">
                        Nenhum item calculado ainda.
                    </div>
                </div>

                <div class="receipt-total">
                    TOTAL A PAGAR: R$ <span id="totalAmount">0,00</span>
                </div>
            </div>
        </div>
      </div>

    </main>

    <script>
      // Atualiza Data/Hora
      function updateDateTime() {
        const now = new Date();
        const dateEl = document.getElementById("currentDate");
        const timeEl = document.getElementById("currentTime");
        if(dateEl) dateEl.textContent = now.toLocaleDateString("pt-BR");
        if(timeEl) timeEl.textContent = now.toLocaleTimeString("pt-BR");
      }
      updateDateTime();

      // Fun√ß√µes de Moeda (Centavos)
      function toCents(value) { return Math.round(value * 100); }
      function fromCents(cents) { return cents / 100; }
      function formatCurrency(cents) {
        const reais = fromCents(cents);
        return reais.toLocaleString("pt-BR", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }

      // Estado
      let items = [];
      let totalCents = 0;
      let itemCount = 0;

      // Event Listeners
      document.getElementById("printButton").addEventListener("click", () => window.print());

      document.getElementById("addButton").addEventListener("click", function () {
          const invoiceNumber = document.getElementById("invoiceNumber").value;
          const waterQuantity = parseFloat(document.getElementById("waterQuantity").value);
          const invoiceValue = parseFloat(document.getElementById("invoiceValue").value);
          const errorElement = document.getElementById("errorMessage");
          const receiptItemsContainer = document.getElementById("receiptItems");

          // Valida√ß√£o
          if (!invoiceNumber || isNaN(waterQuantity) || isNaN(invoiceValue)) {
            errorElement.textContent = "‚ö†Ô∏è Preencha todos os campos corretamente.";
            return;
          }
          if (waterQuantity <= 0 || invoiceValue <= 0) {
            errorElement.textContent = "‚ö†Ô∏è Quantidade e valor devem ser maiores que zero.";
            return;
          }
          errorElement.textContent = "";

          // Remove mensagem de "vazio" se for o primeiro item
          if (itemCount === 0) receiptItemsContainer.innerHTML = "";

          // C√°lculos (L√≥gica Original)
          const invoiceValueCents = toCents(invoiceValue);
          const baseIcmsStCents = toCents(waterQuantity * 12.96);
          const reducedBaseIcmsStCents = Math.round(baseIcmsStCents * (1 - 0.6111));
          const icmsStCents = Math.round(reducedBaseIcmsStCents * 0.18);
          const reducedInvoiceValueCents = Math.round(invoiceValueCents * (1 - 0.6111));
          const icmsCreditCents = Math.round(reducedInvoiceValueCents * 0.18);
          const amountToPayCents = icmsStCents - icmsCreditCents;

          // Atualiza Estado
          itemCount++;
          totalCents += amountToPayCents;

          // Cria Elemento HTML
          const itemDiv = document.createElement("div");
          itemDiv.className = "receipt-item";
          itemDiv.innerHTML = `
            <div class="calculation-line" style="font-weight:bold; margin-bottom: 5px;">#${itemCount} - NF: ${invoiceNumber}</div>
            <div class="calculation-line">Qtd: ${waterQuantity} | Valor NF: R$ ${formatCurrency(invoiceValueCents)}</div>
            <div class="calculation-line">
                Base ST (Pauta): R$ ${formatCurrency(baseIcmsStCents)} <br>
                Base Reduzida: R$ ${formatCurrency(reducedBaseIcmsStCents)} <br>
                ICMS ST (18%): R$ ${formatCurrency(icmsStCents)}
            </div>
            <div class="calculation-line" style="color: #666;">
                (-) Cr√©dito: R$ ${formatCurrency(icmsCreditCents)}
            </div>
            <div class="calculation-line" style="font-weight: bold; margin-top: 5px; font-size: 1rem;">
                = R$ ${formatCurrency(amountToPayCents)}
            </div>
          `;

          receiptItemsContainer.appendChild(itemDiv);

          // Atualiza Total
          document.getElementById("totalAmount").textContent = formatCurrency(totalCents);

          // Limpa Inputs
          document.getElementById("invoiceNumber").value = "";
          document.getElementById("waterQuantity").value = "";
          document.getElementById("invoiceValue").value = "";

          // Scroll para baixo na √°rea do recibo
          const paper = document.querySelector(".receipt-paper");
          paper.scrollTop = paper.scrollHeight;
      });
    </script>
  </body>
</html>