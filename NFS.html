<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-6XKND47T4H"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-6XKND47T4H");
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ferramentas Contábeis [NEO-BRUTALISM]</title>
    <link rel="icon" href="icone.ico" type="image/x-icon" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&family=Space+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg-body: #fff7ed;
        --card-bg: #ffffff;
        --border-color: #000000;
        --color-primary: #8b5cf6;
        --color-secondary: #f472b6;
        --color-accent: #facc15;
        --color-info: #06b6d4;
        --color-success: #22c55e;
        --color-danger: #ef4444;
        --border-width: 3px;
        --shadow-dist: 6px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Space Grotesk", sans-serif;
        background-color: var(--color-info);
        background-image: linear-gradient(#fff 2px, transparent 2px),
          linear-gradient(90deg, #fff 2px, transparent 2px);
        background-size: 40px 40px;
        color: var(--border-color);
        padding: 20px;
        padding-top: 100px;
      }

      .container {
        max-width: 1250px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 2rem;
        background: var(--color-primary);
        border: var(--border-width) solid #000;
        padding: 1.5rem;
        box-shadow: var(--shadow-dist) var(--shadow-dist) 0 #000;
        color: #fff;
      }

      .header h1 {
        font-size: 2rem;
        text-transform: uppercase;
        text-shadow: 2px 2px 0 #000;
      }

      .content-card {
        background: #fff;
        border: var(--border-width) solid #000;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow-dist) var(--shadow-dist) 0 #000;
      }

      .content-card h2 {
        background-color: var(--color-accent);
        border: var(--border-width) solid #000;
        padding: 8px 15px;
        display: inline-block;
        margin-bottom: 1.5rem;
        font-size: 1.2rem;
        text-transform: uppercase;
        box-shadow: 3px 3px 0 #000;
      }

      .input-grid-container {
        border: var(--border-width) solid #000;
        padding: 10px;
        background: var(--color-primary);
        overflow-x: auto;
      }

      .input-row-header {
        display: flex;
        background: #000;
        color: #fff;
        padding: 8px;
        font-family: "Space Mono", monospace;
        font-size: 0.75rem;
        font-weight: bold;
        text-transform: uppercase;
        gap: 8px;
      }

      .input-row-header div {
        flex: 1;
        text-align: center;
      }
      .col-small {
        flex: 0.6 !important;
      }
      .col-medium {
        flex: 1.2 !important;
      }
      .col-action {
        flex: 0.3 !important;
      }

      .input-row {
        display: flex;
        background: #fff;
        border: 2px solid #000;
        padding: 8px;
        margin-top: 8px;
        gap: 8px;
        align-items: flex-end;
      }

      .input-row div {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .input-row label {
        font-family: "Space Mono", monospace;
        font-size: 0.65rem;
        font-weight: bold;
        margin-bottom: 4px;
      }

      .input-row input {
        width: 100%;
        padding: 6px;
        border: 2px solid #000;
        font-family: "Space Mono", monospace;
        font-size: 0.85rem;
        background: #f3f4f6;
      }

      .input-error {
        border-color: var(--color-danger) !important;
        background-color: #fee2e2 !important;
        box-shadow: 3px 3px 0 var(--color-danger) !important;
        animation: shake 0.4s ease-in-out;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        50% {
          transform: translateX(5px);
        }
        75% {
          transform: translateX(-5px);
        }
      }

      .btn {
        border: var(--border-width) solid #000;
        padding: 10px 20px;
        font-weight: 800;
        font-family: "Space Grotesk", sans-serif;
        text-transform: uppercase;
        cursor: pointer;
        font-size: 0.9rem;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background-color: #fff;
        box-shadow: 4px 4px 0 #000;
        transition: all 0.1s;
      }

      .btn:hover {
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 #000;
      }
      #nfs-add-row-btn {
        background-color: var(--color-info);
      }
      #nfs-generate-btn {
        background-color: var(--color-secondary);
        color: #fff;
      }
      #nfs-how-to-import-btn {
        background-color: var(--color-accent);
      }

      .delete-row-btn {
        background: var(--color-danger);
        color: #fff;
        border: 2px solid #000;
        height: 32px;
        width: 32px;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* MODAL REESTRUTURADO */
      .custom-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        backdrop-filter: blur(8px);
      }
      .custom-modal-overlay.visible {
        display: flex;
      }
      .custom-modal-content {
        background: #fff;
        border: 4px solid #000;
        padding: 0;
        max-width: 600px;
        width: 90%;
        box-shadow: 15px 15px 0 #000;
        text-align: left;
        overflow: hidden;
      }
      .modal-header-bar {
        background: #000;
        color: var(--color-accent);
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .modal-body {
        padding: 25px;
      }

      @media (max-width: 992px) {
        .input-row-header {
          display: none;
        }
        .input-row {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <main id="page-nfs" class="page-content active">
      <div class="container">
        <div class="header">
          <h1>Layout Notas Fiscais</h1>
          <p>Importação Sistema Domínio</p>
        </div>
        <div class="content-card">
          <h2><i class="fa-solid fa-bolt"></i> Inserir Dados</h2>
          <form id="nfs-data-form" novalidate>
            <div class="input-grid-container">
              <div class="input-row-header">
                <div class="col-small">Espécie</div>
                <div class="col-medium">CNPJ</div>
                <div class="col-small">Acumul.</div>
                <div class="col-small">CFOP</div>
                <div class="col-small">NF</div>
                <div>Data Entrada</div>
                <div class="col-small">Valor NF</div>
                <div class="col-small">IRRF</div>
                <div class="col-small">CSRF</div>
                <div class="col-action"></div>
              </div>
              <div id="nfs-input-rows"></div>
            </div>
            <div
              class="actions"
              style="margin-top: 20px; display: flex; gap: 10px"
            >
              <button type="button" id="nfs-add-row-btn" class="btn">
                <i class="fa-solid fa-plus"></i> Add Linha
              </button>
              <button type="button" id="nfs-generate-btn" class="btn">
                <i class="fa-solid fa-file-export"></i> GERAR TXT
              </button>
              <button type="button" id="nfs-how-to-import-btn" class="btn">
                <i class="fa-solid fa-circle-question"></i> COMO IMPORTAR?
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <div id="generic-modal" class="custom-modal-overlay">
      <div class="custom-modal-content">
        <div class="modal-header-bar">
          <span
            id="generic-modal-title"
            style="
              font-weight: 900;
              text-transform: uppercase;
              letter-spacing: 1px;
            "
          ></span>
          <i
            class="fa-solid fa-xmark"
            id="generic-modal-x"
            style="cursor: pointer"
          ></i>
        </div>
        <div class="modal-body">
          <div id="generic-modal-text"></div>
          <div style="margin-top: 25px; text-align: right">
            <button
              id="generic-modal-close-btn"
              class="btn"
              style="background: #000; color: #fff"
            >
              FECHAR
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const genericModal = document.getElementById("generic-modal");
      const genericModalTitle = document.getElementById("generic-modal-title");
      const genericModalText = document.getElementById("generic-modal-text");
      const genericModalCloseBtn = document.getElementById(
        "generic-modal-close-btn"
      );
      const genericModalX = document.getElementById("generic-modal-x");

      function showGenericModal(message, title = "Aviso") {
        genericModalTitle.innerHTML = title;
        genericModalText.innerHTML = message;
        genericModal.classList.add("visible");
      }
      const close = () => genericModal.classList.remove("visible");
      genericModalCloseBtn.onclick = close;
      genericModalX.onclick = close;

      (function () {
        const page = document.getElementById("page-nfs");
        const container = page.querySelector("#nfs-input-rows");
        const addBtn = page.querySelector("#nfs-add-row-btn");
        const genBtn = page.querySelector("#nfs-generate-btn");
        const helpBtn = page.querySelector("#nfs-how-to-import-btn");

        const rowHTML = `
            <div class="input-row">
                <div class="col-small"><label>ESPÉCIE</label><input type="text" name="especie" placeholder="Ex: 39" required /></div>
                <div class="col-medium"><label>CNPJ</label><input type="text" name="cnpj" placeholder="Só números" required maxlength="14" /></div>
                <div class="col-small"><label>ACUMUL.</label><input type="text" name="acumulador" placeholder="Ex: 120" required /></div>
                <div class="col-small"><label>CFOP</label><input type="text" name="cfop" placeholder="Ex: 1933" required /></div>
                <div class="col-small"><label>NF</label><input type="text" name="nf" required /></div>
                <div><label>DATA ENTRADA</label><input type="date" name="data_entrada" required /></div>
                <div class="col-small"><label>VALOR NF</label><input type="number" name="valor" step="0.01" required /></div>
                <div class="col-small"><label>IRRF</label><input type="number" name="irrf" step="0.01" placeholder="Opcional" /></div>
                <div class="col-small"><label>CSRF</label><input type="number" name="csrf" step="0.01" placeholder="Opcional" /></div>
                <div class="col-action"><button type="button" class="delete-row-btn">✕</button></div>
            </div>`;

        function addRow() {
          const div = document.createElement("div");
          div.innerHTML = rowHTML.trim();
          container.appendChild(div.firstChild);
        }

        addBtn.addEventListener("click", addRow);
        container.addEventListener("click", (e) => {
          if (e.target.classList.contains("delete-row-btn"))
            e.target.closest(".input-row").remove();
        });

        helpBtn.addEventListener("click", () => {
          showGenericModal(
            `
            <div style="border: 3px solid #000; background: var(--color-accent); padding: 15px; margin-bottom: 20px; box-shadow: 5px 5px 0 #000;">
                <h4 style="display: flex; align-items: center; gap: 10px; text-transform: uppercase;">
                    <i class="fa-solid fa-gears"></i> Módulo Fiscal Domínio
                </h4>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 15px; font-family: 'Space Mono', monospace; font-size: 0.95rem;">
                <div style="background: #f3f4f6; border-left: 8px solid var(--color-primary); padding: 12px;">
                    <span style="color: #666; font-size: 0.7rem; display: block; margin-bottom: 5px;">PASSO 01: CAMINHO</span>
                    <strong>Utilitários > Importação > Importador > Importar</strong>
                </div>

                <div style="background: #f3f4f6; border-left: 8px solid var(--color-secondary); padding: 12px;">
                    <span style="color: #666; font-size: 0.7rem; display: block; margin-bottom: 5px;">PASSO 02: CONFIGURAÇÃO</span>
                    <span>Tipo de Arquivo: <strong style="background: #000; color: #fff; padding: 0 5px;">TXT</strong></span><br>
                    <span>Conjunto de Dados: <strong>Completo (Leiaute Domínio Sistemas)</strong></span>
                </div>
            </div>

            <div style="margin-top: 20px; background: #fff3cd; border: 2px dashed #856404; padding: 10px; font-size: 0.85rem; display: flex; align-items: center; gap: 10px;">
                <i class="fa-solid fa-circle-info" style="color: #856404; font-size: 1.2rem;"></i>
                <span>Certifique-se de que a empresa ativa no sistema corresponde aos dados informados.</span>
            </div>
          `,
            "Guia de Importação"
          );
        });

        genBtn.addEventListener("click", () => {
          let hasError = false;
          let txt = "";

          container.querySelectorAll(".input-row").forEach((row) => {
            const inputs = row.querySelectorAll("input[required]");
            inputs.forEach((input) => {
              if (!input.value.trim()) {
                input.classList.add("input-error");
                hasError = true;
              } else {
                input.classList.remove("input-error");
              }
            });

            if (!hasError) {
              const v = (n) => row.querySelector(`input[name="${n}"]`).value;
              const dataRaw = v("data_entrada");
              const data = dataRaw.split("-").reverse().join("/");
              const fmtV = (val) =>
                (parseFloat(val) || 0).toFixed(2).replace(".", ",");

              txt += `|1000|${v("especie")}|${v("cnpj")}||${v(
                "acumulador"
              )}|${v("cfop")}||${v("nf")}|U||${data}|${data}|${fmtV(
                v("valor")
              )}||||||||||||||||||||||||||${fmtV(
                v("valor")
              )}||||||||||||||||||||||||||||||||||||||||||||||||||||||||||\n`;
              if (parseFloat(v("irrf")) > 0)
                txt += `|1020|16||${fmtV(v("valor"))}|1,50|${fmtV(
                  v("irrf")
                )}|||||${fmtV(v("valor"))}|170806||||\n`;
              if (parseFloat(v("csrf")) > 0)
                txt += `|1020|25||${fmtV(v("valor"))}|4,65|${fmtV(
                  v("csrf")
                )}|||||${fmtV(v("valor"))}|595207||||\n`;
            }
          });

          if (hasError) {
            showGenericModal(
              "Corrija os campos obrigatórios destacados em vermelho.",
              "Erro de Validação"
            );
            return;
          }

          if (!txt) return showGenericModal("Nenhum dado válido encontrado.");

          const blob = new Blob([txt], { type: "text/plain" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = "layout_gerado.txt";
          a.click();
        });

        addRow();
      })();
    </script>
  </body>
</html>
