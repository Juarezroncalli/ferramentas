<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora ISS Simples - Neo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
      :root {
        /* Paleta Neo-Brutalismo */
        --bg-color: #FFFDF5;
        --card-bg: #FFFFFF;
        
        --primary-green: #2DDD98;
        --primary-yellow: #FFF59D;
        --primary-purple: #D6BCFA;
        --primary-pink: #FF9EB5;
        --primary-blue: #A5DEFF;
        
        --text-main: #000000;
        --border-black: #000000;
        
        --shadow-hard: 4px 4px 0px 0px #000000;
        --border-width: 3px;
        --radius: 12px;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-main);
        height: 100vh;
        overflow-x: hidden;
        display: flex;
      }

      /* Sidebar */
      .sidebar {
        width: 250px;
        background: var(--card-bg);
        border-right: var(--border-width) solid var(--border-black);
        display: flex;
        flex-direction: column;
        padding: 2rem 1.5rem;
        flex-shrink: 0;
      }

      .logo {
        font-weight: 800;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 3rem;
      }

      .logo i {
        background: var(--primary-pink);
        padding: 8px;
        border: var(--border-width) solid var(--border-black);
        border-radius: 50%;
        box-shadow: 2px 2px 0 0 black;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        font-weight: 600;
        color: #555;
        cursor: pointer;
        transition: 0.2s;
        border-radius: var(--radius);
        border: 2px solid transparent;
      }

      .nav-item.active {
        background-color: var(--primary-green);
        color: black;
        border: var(--border-width) solid var(--border-black);
        box-shadow: var(--shadow-hard);
      }
      .nav-item:hover:not(.active) { background-color: #f0f0f0; }

      .main-content { flex: 1; padding: 2rem; overflow-y: auto; }

      /* Neo Header */
      .neo-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        background: var(--card-bg);
        border: var(--border-width) solid var(--border-black);
        border-radius: 50px;
        padding: 1rem 2rem;
        box-shadow: var(--shadow-hard);
      }
      .header-title h1 { font-weight: 800; font-size: 2rem; }
      .header-title span { font-size: 1rem; font-weight: 600; color: #666; }

      /* Input Section */
      .input-card {
        background: var(--card-bg);
        border: var(--border-width) solid var(--border-black);
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow-hard);
        margin-bottom: 2rem;
        max-width: 650px;
      }

      label {
        font-weight: 800;
        display: block;
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
      }

      .input-wrapper {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .neo-input {
        flex: 1;
        padding: 1rem;
        font-size: 1.2rem;
        font-weight: bold;
        border: var(--border-width) solid var(--border-black);
        border-radius: var(--radius);
        outline: none;
        min-width: 200px;
      }
      .neo-input:focus {
        background-color: #fff;
        box-shadow: 4px 4px 0 0 rgba(0,0,0,0.1);
      }

      .neo-btn {
        padding: 1rem 2rem;
        font-weight: 800;
        font-size: 1.1rem;
        border: var(--border-width) solid var(--border-black);
        border-radius: var(--radius);
        cursor: pointer;
        box-shadow: var(--shadow-hard);
        background-color: var(--primary-green);
        color: black;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: transform 0.1s;
      }
      .neo-btn:active {
        box-shadow: 0 0 0 0 black;
        transform: translate(4px, 4px);
      }

      /* Results Grid */
      .results-area {
        margin-top: 3rem;
      }
      
      .results-intro {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: #eee;
        border: 2px solid black;
        border-radius: var(--radius);
        display: inline-block;
      }

      .grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .anexo-card {
        background: white;
        border: var(--border-width) solid black;
        border-radius: var(--radius);
        box-shadow: var(--shadow-hard);
        overflow: hidden;
        transition: transform 0.2s;
        position: relative;
      }
      .anexo-card:hover { transform: translate(-4px, -4px); box-shadow: 8px 8px 0 0 black; }

      .card-header {
        padding: 1rem;
        border-bottom: var(--border-width) solid black;
        font-weight: 800;
        text-transform: uppercase;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .card-body {
        padding: 1.5rem;
        text-align: center;
      }

      .percent-value {
        font-size: 2.2rem;
        font-weight: 900;
        display: block;
        margin-bottom: 0.5rem;
      }
      
      .percent-label {
        font-size: 0.9rem;
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
      }

      /* Cores dos Cards */
      .c-green .card-header { background-color: var(--primary-green); }
      .c-yellow .card-header { background-color: var(--primary-yellow); }
      .c-purple .card-header { background-color: var(--primary-purple); }
      .c-pink .card-header { background-color: var(--primary-pink); }
      .c-blue .card-header { background-color: var(--primary-blue); }

      /* ISS Highlight Card */
      .iss-card {
        background: var(--primary-blue);
        border: var(--border-width) solid black;
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow-hard);
        text-align: center;
        max-width: 600px;
        margin: 0 auto;
        position: relative;
      }
      .iss-card h4 { font-size: 1.2rem; margin-bottom: 1rem; text-transform: uppercase; font-weight: 800; }
      .iss-value { font-size: 3.5rem; font-weight: 900; color: black; line-height: 1; }
      .iss-badge { 
        position: absolute; top: -15px; right: -15px; 
        background: var(--primary-pink); border: 3px solid black; 
        padding: 5px 15px; font-weight: 800; transform: rotate(10deg);
        box-shadow: 4px 4px 0 0 black;
      }

      /* Error Message */
      #errorMessage {
        margin-top: 1rem;
        padding: 1rem;
        border: var(--border-width) solid black;
        background-color: #FF5252;
        color: black;
        font-weight: bold;
        border-radius: var(--radius);
        display: none;
        box-shadow: var(--shadow-hard);
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 3rem;
        border: 3px dashed #ccc;
        border-radius: var(--radius);
        color: #888;
        font-weight: 600;
      }

      @media (max-width: 768px) {
        body { flex-direction: column; }
        .sidebar { width: 100%; border-right: none; border-bottom: 3px solid black; flex-direction: row; align-items: center; overflow-x: auto; padding: 1rem; }
        .neo-header { flex-direction: column; gap: 1rem; text-align: center; }
        .input-wrapper { flex-direction: column; }
        .neo-btn { width: 100%; justify-content: center; }
      }
    </style>
  </head>
  <body>

    <aside class="sidebar">
      <div class="logo">
        <i class="fas fa-percent"></i>
        <span>IssCalc</span>
      </div>
      <nav>
        <div class="nav-item active">
          <i class="fas fa-calculator"></i> Calculadora ISS
        </div>
        <div class="nav-item">
          <i class="fas fa-info-circle"></i> Sobre RBT12
        </div>
      </nav>
    </aside>

    <main class="main-content">
      
      <div class="neo-header">
        <div class="header-title">
          <h1>ISS Simples Nacional üèõÔ∏è</h1>
          <span>C√°lculo de al√≠quota efetiva baseada no RBT12</span>
        </div>
      </div>

      <div class="input-card">
        <label for="rbt12Input">
          <i class="fas fa-money-bill-wave"></i> Informe o RBT12 (√öltimos 12 Meses)
        </label>
        <div class="input-wrapper">
          <input type="text" id="rbt12Input" class="neo-input" placeholder="R$ 0,00" inputmode="decimal" />
          <button id="calculateButton" class="neo-btn">
            CALCULAR <i class="fas fa-bolt"></i>
          </button>
        </div>
        <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
          *Use v√≠rgula para centavos.
        </div>
        <div id="errorMessage"></div>
      </div>

      <div class="results-area" id="resultsOutput">
        <div class="empty-state">
          <i class="fas fa-file-invoice-dollar" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
          Digite o RBT12 acima para ver as al√≠quotas e o ISS estimado.
        </div>
      </div>

    </main>

    <script>
      const rbt12Input = document.getElementById("rbt12Input");
      const calculateButton = document.getElementById("calculateButton");
      const resultsOutput = document.getElementById("resultsOutput");
      const errorMessageDiv = document.getElementById("errorMessage");

      // --- Fun√ß√µes Auxiliares ---
      function parseCurrencyInput(inputString) {
        if (typeof inputString !== "string" || inputString.trim() === "") return null;
        let cleanedString = inputString.replace(/R\$\s?/g, "").replace(/\./g, "").trim().replace(",", ".");
        if (!/^-?\d+(\.\d+)?$/.test(cleanedString) || cleanedString === "-") return null;
        return parseFloat(cleanedString);
      }

      function formatCurrency(value) {
        let numValue = typeof value === "number" ? value : parseCurrencyInput(String(value));
        if (numValue === null || isNaN(numValue)) return "";
        return numValue.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
      }

      function formatPercentage(value) {
        if (typeof value !== "number" || isNaN(value)) return "--";
        return `${value.toLocaleString("pt-BR", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}%`;
      }

      // --- Interface Logic ---
      rbt12Input.addEventListener("blur", () => {
        const numericValue = parseCurrencyInput(rbt12Input.value);
        if (numericValue !== null) {
          rbt12Input.value = formatCurrency(numericValue).replace("R$", "").trim();
        }
      });

      rbt12Input.addEventListener("input", () => {
        errorMessageDiv.style.display = "none";
      });

      calculateButton.addEventListener("click", () => {
        const rbt12Value = parseCurrencyInput(rbt12Input.value);
        if (rbt12Value === null) {
          showError("Valor inv√°lido. Digite apenas n√∫meros.");
          return;
        }
        if (rbt12Value < 0) {
          showError("O RBT12 n√£o pode ser negativo.");
          return;
        }
        performCalculation(rbt12Value);
      });

      function showError(msg) {
        errorMessageDiv.textContent = "‚ö†Ô∏è " + msg;
        errorMessageDiv.style.display = "block";
      }

      // --- Renderiza√ß√£o Neo-Brutalista ---
      function performCalculation(rbt12Value) {
        resultsOutput.innerHTML = ""; // Limpar

        // Intro
        const intro = document.createElement("div");
        intro.className = "results-intro";
        intro.innerHTML = `Base de C√°lculo RBT12: <strong>${formatCurrency(rbt12Value)}</strong>`;
        resultsOutput.appendChild(intro);

        // Grid Container (Anexos Gerais)
        const grid = document.createElement("div");
        grid.className = "grid-container";

        const anexos = {
            "Anexo I": { val: calculateAnexoI(rbt12Value), color: "c-green", label: "Com√©rcio" },
            "Anexo II": { val: calculateAnexoII(rbt12Value), color: "c-yellow", label: "Ind√∫stria" },
            "Anexo III": { val: calculateAnexoIII(rbt12Value), color: "c-purple", label: "Servi√ßos" },
            "Anexo IV": { val: calculateAnexoIV(rbt12Value), color: "c-pink", label: "Servi√ßos" },
            "Anexo V": { val: calculateAnexoV(rbt12Value), color: "c-blue", label: "Servi√ßos" },
        };

        let anexoIIIRate = null; // Para c√°lculo do ISS

        for (const [key, data] of Object.entries(anexos)) {
            const isNumber = typeof data.val === 'number';
            const displayVal = isNumber ? formatPercentage(data.val) : data.val;
            
            // Salva Anexo III para uso posterior
            if (key === "Anexo III" && isNumber) anexoIIIRate = data.val;

            const cardHTML = `
                <div class="anexo-card ${data.color}">
                    <div class="card-header">
                        <span>${key}</span>
                        <i class="fas fa-tag"></i>
                    </div>
                    <div class="card-body">
                        <span class="percent-value" style="${!isNumber ? 'font-size: 1.2rem; color: red;' : ''}">
                            ${displayVal}
                        </span>
                        <span class="percent-label">${data.label}</span>
                    </div>
                </div>
            `;
            grid.innerHTML += cardHTML;
        }
        resultsOutput.appendChild(grid);

        // Card de Destaque ISS (Se poss√≠vel calcular)
        if (anexoIIIRate !== null) {
            const issResult = calculateISS(rbt12Value, anexoIIIRate);
            const issDisplay = typeof issResult === 'number' ? formatPercentage(issResult) : issResult;

            const issHTML = `
                <div class="iss-card">
                    <div class="iss-badge">ESTIMADO</div>
                    <h4>Al√≠quota Final de ISS (Reten√ß√£o)</h4>
                    <div class="iss-value">${issDisplay}</div>
                    <div style="margin-top: 10px; font-weight: 600; opacity: 0.7;">Baseado no Anexo III</div>
                </div>
            `;
            resultsOutput.innerHTML += issHTML;
        }
      }

      // --- L√≥gica de C√°lculo (Mantida Original) ---
      function getEffectiveRate(acumulado, aliquotaNominal, parcelaDeducao) {
        if (acumulado > 4800000) return "Acima do Limite";
        if (acumulado === 0) return aliquotaNominal * 100;
        return (((acumulado * aliquotaNominal - parcelaDeducao) / acumulado) * 100);
      }

      function calculateISS(rbt12, anexoIIIRate) {
        if (rbt12 > 3600000) return "Acima do Teto (ISS)";
        
        let calculatedIss;
        if (rbt12 <= 180000) calculatedIss = anexoIIIRate * 0.335;
        else if (rbt12 <= 360000) calculatedIss = anexoIIIRate * 0.32;
        else if (rbt12 <= 1800000) calculatedIss = anexoIIIRate * 0.325;
        else if (rbt12 <= 3600000) calculatedIss = anexoIIIRate * 0.335;
        else return "?";

        return calculatedIss > 5 ? 5 : calculatedIss;
      }

      function calculateAnexoI(acumulado) {
        if (acumulado > 4800000) return "Acima do Limite";
        if (acumulado <= 180000) return getEffectiveRate(acumulado, 0.04, 0);
        if (acumulado <= 360000) return getEffectiveRate(acumulado, 0.073, 5940);
        if (acumulado <= 720000) return getEffectiveRate(acumulado, 0.095, 13860);
        if (acumulado <= 1800000) return getEffectiveRate(acumulado, 0.107, 22500);
        if (acumulado <= 3600000) return getEffectiveRate(acumulado, 0.143, 87300);
        return getEffectiveRate(acumulado, 0.19, 378000);
      }
      function calculateAnexoII(acumulado) {
        if (acumulado > 4800000) return "Acima do Limite";
        if (acumulado <= 180000) return getEffectiveRate(acumulado, 0.045, 0);
        if (acumulado <= 360000) return getEffectiveRate(acumulado, 0.078, 5940);
        if (acumulado <= 720000) return getEffectiveRate(acumulado, 0.1, 13860);
        if (acumulado <= 1800000) return getEffectiveRate(acumulado, 0.112, 22500);
        if (acumulado <= 3600000) return getEffectiveRate(acumulado, 0.147, 85500);
        return getEffectiveRate(acumulado, 0.3, 720000);
      }
      function calculateAnexoIII(acumulado) {
        if (acumulado > 4800000) return "Acima do Limite";
        if (acumulado <= 180000) return getEffectiveRate(acumulado, 0.06, 0);
        if (acumulado <= 360000) return getEffectiveRate(acumulado, 0.112, 9360);
        if (acumulado <= 720000) return getEffectiveRate(acumulado, 0.135, 17640);
        if (acumulado <= 1800000) return getEffectiveRate(acumulado, 0.16, 35640);
        if (acumulado <= 3600000) return getEffectiveRate(acumulado, 0.21, 125640);
        return getEffectiveRate(acumulado, 0.33, 648000);
      }
      function calculateAnexoIV(acumulado) {
        if (acumulado > 4800000) return "Acima do Limite";
        if (acumulado <= 180000) return getEffectiveRate(acumulado, 0.045, 0);
        if (acumulado <= 360000) return getEffectiveRate(acumulado, 0.09, 8100);
        if (acumulado <= 720000) return getEffectiveRate(acumulado, 0.102, 12420);
        if (acumulado <= 1800000) return getEffectiveRate(acumulado, 0.14, 39780);
        if (acumulado <= 3600000) return getEffectiveRate(acumulado, 0.22, 183780);
        return getEffectiveRate(acumulado, 0.33, 828000);
      }
      function calculateAnexoV(acumulado) {
        if (acumulado > 4800000) return "Acima do Limite";
        if (acumulado <= 180000) return getEffectiveRate(acumulado, 0.155, 0);
        if (acumulado <= 360000) return getEffectiveRate(acumulado, 0.18, 4500);
        if (acumulado <= 720000) return getEffectiveRate(acumulado, 0.195, 9900);
        if (acumulado <= 1800000) return getEffectiveRate(acumulado, 0.205, 17100);
        if (acumulado <= 3600000) return getEffectiveRate(acumulado, 0.23, 62100);
        return getEffectiveRate(acumulado, 0.305, 540000);
      }
    </script>
  </body>
</html>