<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora ISS (Simples) [BRUTALISM]</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
      :root {
        --bg-body: #06B6D4; /* Ciano */
        --card-bg: #FFFFFF;
        --border-black: #000000;
        
        --color-primary: #8B5CF6;   /* Roxo */
        --color-secondary: #F472B6; /* Rosa */
        --color-accent: #FACC15;    /* Amarelo */
        --color-success: #22C55E;   /* Verde */
        --color-info: #3B82F6;      /* Azul Royal */
        --color-danger: #EF4444;    /* Vermelho */
        
        --shadow-dist: 6px;
        --border-width: 3px;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
        font-family: 'Space Grotesk', sans-serif;
        background-color: var(--bg-body);
        background-image: 
            linear-gradient(#fff 2px, transparent 2px),
            linear-gradient(90deg, #fff 2px, transparent 2px);
        background-size: 40px 40px;
        color: var(--border-black);
        height: 100vh;
        display: flex;
        overflow: hidden;
      }

      /* Sidebar */
      .sidebar {
        width: 280px;
        background: var(--color-accent);
        border-right: var(--border-width) solid var(--border-black);
        display: flex;
        flex-direction: column;
        padding: 2rem 1.5rem;
        flex-shrink: 0;
        box-shadow: 4px 0 0 rgba(0,0,0,0.1);
      }

      .logo {
        font-weight: 900;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 3rem;
        text-decoration: none;
        color: var(--border-black);
        text-transform: uppercase;
      }

      .logo i {
        background: var(--color-secondary);
        color: #000;
        padding: 10px;
        border: var(--border-width) solid var(--border-black);
        box-shadow: 4px 4px 0 0 black;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px;
        margin-bottom: 1rem;
        font-weight: 800;
        color: #000;
        border: var(--border-width) solid var(--border-black);
        background: #fff;
        box-shadow: 4px 4px 0 0 black;
        text-transform: uppercase;
        font-size: 0.9rem;
      }

      .nav-item.active {
        background-color: var(--color-primary);
        color: #fff;
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 0 black;
      }

      .main-content { flex: 1; padding: 2rem; overflow-y: auto; }

      /* Neo Header */
      .neo-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2.5rem;
        background: #fff;
        border: var(--border-width) solid var(--border-black);
        padding: 2rem;
        box-shadow: var(--shadow-dist) var(--shadow-dist) 0 #000;
      }
      .header-title h1 { font-weight: 900; font-size: 2.5rem; text-transform: uppercase; }
      .header-title span { 
        font-family: 'Space Mono', monospace;
        background: var(--color-info);
        color: #fff;
        padding: 5px 10px;
        border: 2px solid #000;
        font-weight: 700;
      }

      /* Cards */
      .neo-card {
        background: #fff;
        border: var(--border-width) solid var(--border-black);
        padding: 2rem;
        box-shadow: var(--shadow-dist) var(--shadow-dist) 0 #000;
        margin-bottom: 2rem;
      }
      .card-title {
        font-weight: 900;
        font-size: 1.2rem;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 10px;
        text-transform: uppercase;
        border-bottom: 3px solid #000;
        padding-bottom: 10px;
      }

      .border-top-purple { border-top: 8px solid var(--color-primary); }
      .border-top-green { border-top: 8px solid var(--color-success); }

      /* Input e Bot√µes */
      label {
        font-weight: 800;
        display: block;
        margin-bottom: 0.8rem;
        text-transform: uppercase;
        font-family: 'Space Mono', monospace;
      }

      .input-group { display: flex; gap: 1rem; flex-wrap: wrap; }

      .neo-input {
        flex: 1;
        padding: 15px;
        font-size: 1.5rem;
        font-family: 'Space Mono', monospace;
        font-weight: bold;
        border: var(--border-width) solid var(--border-black);
        background: #F3F4F6;
        min-width: 250px;
      }
      .neo-input:focus { background: #fff; transform: translate(-2px, -2px); box-shadow: 5px 5px 0 0 var(--color-primary); outline: none; }

      .neo-btn {
        padding: 1rem 2rem;
        font-weight: 900;
        font-size: 1.1rem;
        border: var(--border-width) solid var(--border-black);
        cursor: pointer;
        box-shadow: 5px 5px 0 0 black;
        text-transform: uppercase;
        background: var(--color-success);
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .neo-btn:active { transform: translate(4px, 4px); box-shadow: 0 0 0 0 black; }

      /* Results */
      .grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .anexo-card {
        background: #fff;
        border: var(--border-width) solid black;
        box-shadow: 4px 4px 0 0 black;
        padding: 1.5rem;
        text-align: center;
      }
      .anexo-card .tag { 
        font-size: 0.8rem; 
        font-weight: 900; 
        background: var(--color-accent); 
        padding: 2px 8px; 
        border: 1px solid #000;
        text-transform: uppercase;
        margin-bottom: 10px;
        display: inline-block;
      }
      .percent-value { font-size: 2rem; font-weight: 900; display: block; color: var(--border-black); }
      .percent-label { font-size: 0.9rem; font-weight: 700; opacity: 0.7; text-transform: uppercase; }

      /* ISS Special Card */
      .iss-card {
        background: var(--color-primary);
        color: #fff;
        border: var(--border-width) solid black;
        padding: 2.5rem;
        box-shadow: 10px 10px 0 0 black;
        text-align: center;
        max-width: 500px;
        margin: 2rem auto;
        position: relative;
      }
      .iss-card .iss-value { font-size: 4rem; font-weight: 900; line-height: 1; }
      .iss-card .badge {
        position: absolute; top: -15px; right: -15px;
        background: var(--color-accent); color: #000;
        padding: 5px 15px; font-weight: 900; border: 3px solid #000;
        transform: rotate(5deg); box-shadow: 4px 4px 0 0 black;
      }

      #errorMessage {
        background: var(--color-danger); color: white;
        padding: 1rem; border: 3px solid black; margin-top: 1rem;
        font-weight: 900; display: none;
      }

      .empty-state {
        text-align: center; padding: 4rem; border: 4px dashed #000;
        font-weight: 800; color: #000; opacity: 0.5;
      }

      @media (max-width: 768px) {
        body { flex-direction: column; }
        .sidebar { width: 100%; flex-direction: row; border-right: none; border-bottom: 3px solid black; }
        .input-group { flex-direction: column; }
      }
    </style>
  </head>
  <body>

    <aside class="sidebar">
      <div class="logo">
        <i class="fas fa-percent"></i>
        <span>IssCalc</span>
      </div>
      <nav>
        <div class="nav-item active">
          <i class="fas fa-calculator"></i> Calculadora ISS
        </div>
      </nav>
    </aside>

    <main class="main-content">
      
      <div class="neo-header">
        <div class="header-title">
          <h1>ISS Simples Nacional üèõÔ∏è</h1>
          <span>C√°lculo de al√≠quota efetiva (RBT12)</span>
        </div>
      </div>

      <div class="neo-card border-top-purple">
        <div class="card-title"><i class="fas fa-money-bill-wave"></i> Informe a Receita Bruta</div>
        <label>RBT12 (Acumulado 12 meses anteriores)</label>
        <div class="input-group">
          <input type="text" id="rbt12Input" class="neo-input" placeholder="0,00" />
          <button id="calculateButton" class="neo-btn">
            CALCULAR <i class="fas fa-bolt"></i>
          </button>
        </div>
        <div id="errorMessage"></div>
      </div>

      <div id="resultsOutput">
        <div class="empty-state">
          <i class="fas fa-file-invoice-dollar" style="font-size: 3rem; margin-bottom: 1rem;"></i><br>
          AGUARDANDO VALORES PARA C√ÅLCULO
        </div>
      </div>

    </main>

    <script>
      const rbt12Input = document.getElementById("rbt12Input");
      const calculateButton = document.getElementById("calculateButton");
      const resultsOutput = document.getElementById("resultsOutput");
      const errorMessageDiv = document.getElementById("errorMessage");

      // --- Helpers de Formata√ß√£o ---
      function parseCurrency(str) {
        if (!str) return null;
        let cleaned = str.replace(/\./g, "").replace(",", ".").trim();
        return isNaN(parseFloat(cleaned)) ? null : parseFloat(cleaned);
      }

      function formatPercent(val) {
        return typeof val === 'number' ? val.toLocaleString("pt-BR", { minimumFractionDigits: 2 }) + "%" : val;
      }

      // --- L√≥gica de C√°lculo (Conforme solicitado) ---
      function getRate(acum, nom, ded) {
        if (acum > 4800000) return "Limite Excedido";
        return (((acum * nom - ded) / acum) * 100);
      }

      function performCalc(rbt12) {
        resultsOutput.innerHTML = "";

        const anexos = [
          { name: "Anexo I", label: "Com√©rcio", val: calcI(rbt12), color: "var(--color-success)" },
          { name: "Anexo II", label: "Ind√∫stria", val: calcII(rbt12), color: "var(--color-accent)" },
          { name: "Anexo III", label: "Servi√ßos", val: calcIII(rbt12), color: "var(--color-primary)" },
          { name: "Anexo IV", label: "Servi√ßos", val: calcIV(rbt12), color: "var(--color-secondary)" },
          { name: "Anexo V", label: "Servi√ßos", val: calcV(rbt12), color: "var(--color-info)" }
        ];

        const grid = document.createElement("div");
        grid.className = "grid-container";
        
        anexos.forEach(a => {
          grid.innerHTML += `
            <div class="anexo-card" style="border-top: 8px solid ${a.color}">
              <div class="tag">${a.name}</div>
              <span class="percent-value">${formatPercent(a.val)}</span>
              <span class="percent-label">${a.label}</span>
            </div>`;
        });
        resultsOutput.appendChild(grid);

        // ISS Estimado (Baseado no Anexo III)
        const a3Val = calcIII(rbt12);
        if (typeof a3Val === 'number' && rbt12 <= 3600000) {
          let part = rbt12 <= 180000 ? 0.335 : rbt12 <= 360000 ? 0.32 : rbt12 <= 1800000 ? 0.325 : 0.335;
          let iss = a3Val * part;
          if (iss > 5) iss = 5;

          resultsOutput.innerHTML += `
            <div class="iss-card">
              <div class="badge">RETEN√á√ÉO</div>
              <p style="font-weight: 900; text-transform: uppercase; margin-bottom: 10px;">Al√≠quota ISS Estimada</p>
              <div class="iss-value">${iss.toFixed(2)}%</div>
              <p style="margin-top: 10px; font-weight: 700; opacity: 0.8;">(Base Anexo III)</p>
            </div>`;
        }
      }

      // Fun√ß√µes de Faixas (L√≥gica Original)
      function calcI(a) {
        if(a <= 180000) return getRate(a, 0.04, 0);
        if(a <= 360000) return getRate(a, 0.073, 5940);
        if(a <= 720000) return getRate(a, 0.095, 13860);
        if(a <= 1800000) return getRate(a, 0.107, 22500);
        if(a <= 3600000) return getRate(a, 0.143, 87300);
        return getRate(a, 0.19, 378000);
      }
      function calcII(a) {
        if(a <= 180000) return getRate(a, 0.045, 0);
        if(a <= 360000) return getRate(a, 0.078, 5940);
        if(a <= 720000) return getRate(a, 0.1, 13860);
        if(a <= 1800000) return getRate(a, 0.112, 22500);
        if(a <= 3600000) return getRate(a, 0.147, 85500);
        return getRate(a, 0.3, 720000);
      }
      function calcIII(a) {
        if(a <= 180000) return getRate(a, 0.06, 0);
        if(a <= 360000) return getRate(a, 0.112, 9360);
        if(a <= 720000) return getRate(a, 0.135, 17640);
        if(a <= 1800000) return getRate(a, 0.16, 35640);
        if(a <= 3600000) return getRate(a, 0.21, 125640);
        return getRate(a, 0.33, 648000);
      }
      function calcIV(a) {
        if(a <= 180000) return getRate(a, 0.045, 0);
        if(a <= 360000) return getRate(a, 0.09, 8100);
        if(a <= 720000) return getRate(a, 0.102, 12420);
        if(a <= 1800000) return getRate(a, 0.14, 39780);
        if(a <= 3600000) return getRate(a, 0.22, 183780);
        return getRate(a, 0.33, 828000);
      }
      function calcV(a) {
        if(a <= 180000) return getRate(a, 0.155, 0);
        if(a <= 360000) return getRate(a, 0.18, 4500);
        if(a <= 720000) return getRate(a, 0.195, 9900);
        if(a <= 1800000) return getRate(a, 0.205, 17100);
        if(a <= 3600000) return getRate(a, 0.23, 62100);
        return getRate(a, 0.305, 540000);
      }

      calculateButton.addEventListener("click", () => {
        const val = parseCurrency(rbt12Input.value);
        if (val === null || val < 0) {
          errorMessageDiv.textContent = "‚ö†Ô∏è Informe um valor num√©rico v√°lido.";
          errorMessageDiv.style.display = "block";
          return;
        }
        errorMessageDiv.style.display = "none";
        performCalc(val);
      });
    </script>
  </body>
</html>